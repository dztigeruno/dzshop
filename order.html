<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إتمام الطلب - POTI PATI</title>
    
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- Language Switcher -->
    <div class="language-switcher bg-primary text-white py-2">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <i class="fas fa-globe me-2"></i>
                    <span data-translate="language">اللغة</span>
                </div>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-light btn-sm lang-btn active" data-lang="ar">
                        <img src="https://flagcdn.com/w20/dz.png" alt="العربية" class="me-1">
                        العربية
                    </button>
                    <button type="button" class="btn btn-outline-light btn-sm lang-btn" data-lang="fr">
                        <img src="https://flagcdn.com/w20/fr.png" alt="Français" class="me-1">
                        Français
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="index.html">
                <i class="fas fa-shopping-bag me-2"></i>POTI PATI
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html" data-translate="home">الرئيسية</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="product.html" data-translate="product">المنتج</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="order.html" data-translate="order">الطلب</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html" data-translate="about">من نحن</a>
                    </li>
                </ul>
                
                <div class="d-flex align-items-center">
                    <a href="admin/login.html" class="btn btn-primary" data-translate="admin">لوحة التحكم</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Checkout Progress -->
    <section class="py-3 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="checkout-progress d-flex justify-content-center">
                        <div class="progress-step active me-4">
                            <div class="step-number">1</div>
                            <div class="step-label">معلومات المنتج</div>
                        </div>
                        <div class="progress-line me-4"></div>
                        <div class="progress-step active me-4">
                            <div class="step-number">2</div>
                            <div class="step-label">معلومات التوصيل</div>
                        </div>
                        <div class="progress-line me-4"></div>
                        <div class="progress-step">
                            <div class="step-number">3</div>
                            <div class="step-label">تأكيد الطلب</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Checkout Section -->
    <section class="py-5">
        <div class="container">
            <div class="row g-5">
                <!-- Order Form -->
                <div class="col-lg-8">
                    <form id="orderForm" class="needs-validation" novalidate>
                        <!-- Customer Information -->
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-user me-2"></i>
                                    معلومات العميل
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="firstName" class="form-label">الاسم الأول <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="firstName" name="firstName" required>
                                        <div class="invalid-feedback">يرجى إدخال الاسم الأول</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="lastName" class="form-label">اسم العائلة <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="lastName" name="lastName" required>
                                        <div class="invalid-feedback">يرجى إدخال اسم العائلة</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="email" class="form-label">البريد الإلكتروني</label>
                                        <input type="email" class="form-control" id="email" name="email">
                                        <div class="invalid-feedback">يرجى إدخال بريد إلكتروني صحيح</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="phone" class="form-label">رقم الهاتف <span class="text-danger">*</span></label>
                                        <input type="tel" class="form-control" id="phone" name="phone" pattern="[0-9]{10}" required>
                                        <div class="invalid-feedback">يرجى إدخال رقم هاتف صحيح (10 أرقام)</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Delivery Address -->
                        <div class="card mb-4">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-truck me-2"></i>
                                    عنوان التوصيل
                                </h5>
                            </div>
                            <div class="card-body location-selector">
                                <!-- Algerian Wilayas Selection -->
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="wilaya" class="form-label">الولاية <span class="text-danger">*</span></label>
                                        <select class="form-select" id="wilaya" name="wilaya" required onchange="loadCommunes()">
                                            <option value="">اختر الولاية</option>
                                            <!-- Options will be loaded via AJAX -->
                                        </select>
                                        <div class="invalid-feedback">يرجى اختيار الولاية</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="commune" class="form-label">البلدية <span class="text-danger">*</span></label>
                                        <select class="form-select" id="commune" name="commune" required disabled>
                                            <option value="">اختر البلدية أولاً</option>
                                        </select>
                                        <div class="invalid-feedback">يرجى اختيار البلدية</div>
                                    </div>
                                </div>

                                <div class="row g-3 mt-2">
                                    <div class="col-md-8">
                                        <label for="address" class="form-label">العنوان التفصيلي <span class="text-danger">*</span></label>
                                        <textarea class="form-control" id="address" name="address" rows="3" placeholder="مثال: حي النصر، شارع الاستقلال، بناية رقم 123" required></textarea>
                                        <div class="invalid-feedback">يرجى إدخال العنوان التفصيلي</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="postalCode" class="form-label">الرمز البريدي</label>
                                        <input type="text" class="form-control" id="postalCode" name="postalCode" pattern="[0-9]{5}">
                                        <div class="invalid-feedback">يرجى إدخال رمز بريدي صحيح (5 أرقام)</div>
                                    </div>
                                </div>

                                <!-- Delivery Time Selection -->
                                <div class="mt-3">
                                    <label class="form-label">وقت التوصيل المفضل</label>
                                    <div class="row g-2">
                                        <div class="col-auto">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="deliveryTime" id="morning" value="morning">
                                                <label class="form-check-label" for="morning">
                                                    <i class="fas fa-sun text-warning me-1"></i>
                                                    صباحاً (9ص - 12م)
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="deliveryTime" id="afternoon" value="afternoon">
                                                <label class="form-check-label" for="afternoon">
                                                    <i class="fas fa-cloud-sun text-info me-1"></i>
                                                    بعد الظهر (12م - 6م)
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="deliveryTime" id="evening" value="evening">
                                                <label class="form-check-label" for="evening">
                                                    <i class="fas fa-moon text-dark me-1"></i>
                                                    مساءً (6م - 9م)
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Method -->
                        <div class="card mb-4">
                            <div class="card-header bg-accent text-dark">
                                <h5 class="mb-0">
                                    <i class="fas fa-credit-card me-2"></i>
                                    طريقة الدفع
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="payment-methods">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="cod" checked>
                                        <label class="form-check-label" for="cod">
                                            <i class="fas fa-money-bill-wave text-success me-2"></i>
                                            <strong>الدفع عند الاستلام</strong>
                                            <small class="text-muted d-block">ادفع نقداً عند استلام المنتج</small>
                                        </label>
                                    </div>
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <strong>نصائح للتوصيل:</strong>
                                        <ul class="mb-0 mt-2">
                                            <li>التوصيل مجاني للطلبات أكثر من 5,000 د.ج</li>
                                            <li>رسوم التوصيل للمناطق النائية: 500 د.ج</li>
                                            <li>وقت التوصيل: 2-5 أيام عمل</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Special Instructions -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h5 class="mb-0">
                                    <i class="fas fa-comment-alt me-2"></i>
                                    ملاحظات إضافية
                                </h5>
                            </div>
                            <div class="card-body">
                                <textarea class="form-control" name="notes" rows="3" placeholder="أي ملاحظات أو طلبات خاصة..."></textarea>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg px-5">
                                <i class="fas fa-check-circle me-2"></i>
                                تأكيد الطلب
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Order Summary -->
                <div class="col-lg-4">
                    <div class="order-summary">
                        <h4 class="fw-bold mb-4">ملخص الطلب</h4>
                        
                        <!-- Product Summary -->
                        <div id="productSummary" class="mb-4">
                            <!-- Product details will be loaded here -->
                        </div>

                        <!-- Shipping Cost -->
                        <div class="summary-item">
                            <span>رسوم التوصيل</span>
                            <span id="shippingCost">1,000 د.ج</span>
                        </div>

                        <!-- Total -->
                        <div class="summary-item fw-bold">
                            <span>المجموع الكلي</span>
                            <span id="totalAmount">16,999 د.ج</span>
                        </div>

                        <!-- Delivery Info -->
                        <div class="alert alert-warning mt-3">
                            <i class="fas fa-truck me-2"></i>
                            <strong>معلومات التوصيل:</strong>
                            <ul class="mb-0 mt-2">
                                <li>وقت التوصيل: 2-5 أيام</li>
                                <li>التوصيل مجاني للطلبات +5,000 د.ج</li>
                                <li>الدفع عند الاستلام</li>
                            </ul>
                        </div>

                        <!-- Trust Badges -->
                        <div class="trust-badges text-center mt-4">
                            <div class="row g-2">
                                <div class="col-4">
                                    <div class="badge-item">
                                        <i class="fas fa-shield-alt text-primary fa-2x mb-2"></i>
                                        <small class="d-block">آمن 100%</small>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="badge-item">
                                        <i class="fas fa-shipping-fast text-success fa-2x mb-2"></i>
                                        <small class="d-block">توصيل سريع</small>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="badge-item">
                                        <i class="fas fa-headset text-info fa-2x mb-2"></i>
                                        <small class="d-block">دعم 24/7</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- WhatsApp Integration -->
    <div class="whatsapp-float">
        <a href="https://wa.me/213555123456?text=مرحباً، أحتاج مساعدة في إتمام طلبي" 
           target="_blank" class="btn btn-success rounded-circle shadow-3d">
            <i class="fab fa-whatsapp fa-2x"></i>
        </a>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-5">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-4">
                    <h5 class="fw-bold mb-3">
                        <i class="fas fa-shopping-bag me-2 text-primary"></i>POTI PATI
                    </h5>
                    <p>متجرك الإلكتروني الأول للتسوق الآمن في الجزائر</p>
                </div>
                <div class="col-lg-2">
                    <h6 class="fw-bold mb-3">روابط سريعة</h6>
                    <ul class="list-unstyled">
                        <li><a href="index.html" class="text-light text-decoration-none">الرئيسية</a></li>
                        <li><a href="product.html" class="text-light text-decoration-none">المنتج</a></li>
                        <li><a href="about.html" class="text-light text-decoration-none">من نحن</a></li>
                    </ul>
                </div>
                <div class="col-lg-3">
                    <h6 class="fw-bold mb-3">معلومات التواصل</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="fas fa-phone me-2 text-primary"></i>
                            +213 555 123 456
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-envelope me-2 text-primary"></i>
                            info@potipati.dz
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5.3 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="assets/js/main.js"></script>

    <!-- Order Page JS -->
    <script>
        // Algerian Wilayas and Communes Data
        const algerianWilayas = [
            { id: 1, name: 'أدرار', communes: ['أدرار', 'أولاد رضا', 'بتروة', 'تقور', 'تامست', 'تيميمون', 'فوكة', 'إن زغم'] },
            { id: 2, name: 'الشلف', communes: ['الشلف', 'أولاد بن عبد القادر', 'الحجاج', 'التيطار', 'سيدي عكاز', 'بني راشد', 'بوقادير', 'الظهرة'] },
            { id: 3, name: 'الأغواط', communes: ['الأغواط', 'أغريب', 'قعدة الرحمة', 'الحاج مختار', 'العزيزية', 'سيدي مخلوف', 'تاجموت', 'تفرسيت'] },
            // Add more wilayas as needed...
        ];

        let currentProduct = null;
        let shippingCost = 1000; // Default shipping cost

        // Initialize order page
        document.addEventListener('DOMContentLoaded', function() {
            loadProductFromStorage();
            loadWilayas();
            initializeFormValidation();
            updateOrderSummary();
        });

        function loadProductFromStorage() {
            const productData = localStorage.getItem('selectedProduct');
            if (productData) {
                currentProduct = JSON.parse(productData);
                displayProductSummary();
            } else {
                // Redirect to home if no product selected
                window.location.href = 'index.html';
            }
        }

        function loadWilayas() {
            const wilayaSelect = document.getElementById('wilaya');
            
            // Show loading
            wilayaSelect.innerHTML = '<option value="">جاري التحميل...</option>';
            
            // Simulate API call
            setTimeout(() => {
                wilayaSelect.innerHTML = '<option value="">اختر الولاية</option>';
                algerianWilayas.forEach(wilaya => {
                    const option = document.createElement('option');
                    option.value = wilaya.id;
                    option.textContent = `${wilaya.id.toString().padStart(2, '0')} - ${wilaya.name}`;
                    wilayaSelect.appendChild(option);
                });
            }, 1000);
        }

        function loadCommunes() {
            const wilayaSelect = document.getElementById('wilaya');
            const communeSelect = document.getElementById('commune');
            const selectedWilayaId = wilayaSelect.value;
            
            if (!selectedWilayaId) {
                communeSelect.innerHTML = '<option value="">اختر البلدية أولاً</option>';
                communeSelect.disabled = true;
                return;
            }

            // Show loading
            communeSelect.innerHTML = '<option value="">جاري التحميل...</option>';
            communeSelect.disabled = false;

            // Find selected wilaya
            const selectedWilaya = algerianWilayas.find(w => w.id == selectedWilayaId);
            
            // Simulate API call
            setTimeout(() => {
                communeSelect.innerHTML = '<option value="">اختر البلدية</option>';
                selectedWilaya.communes.forEach(commune => {
                    const option = document.createElement('option');
                    option.value = commune;
                    option.textContent = commune;
                    communeSelect.appendChild(option);
                });
                
                // Update shipping cost based on wilaya
                updateShippingCost(selectedWilayaId);
            }, 500);
        }

        function updateShippingCost(wilayaId) {
            // Free shipping for major cities (Algiers, Oran, Constantine)
            const majorCities = [16, 31, 25]; // Algiers, Oran, Constantine wilaya IDs
            
            if (majorCities.includes(parseInt(wilayaId))) {
                shippingCost = 0;
            } else {
                shippingCost = 1000; // Standard shipping cost
            }
            
            updateOrderSummary();
        }

        function displayProductSummary() {
            if (!currentProduct) return;

            const productSummary = document.getElementById('productSummary');
            productSummary.innerHTML = `
                <div class="d-flex">
                    <img src="${currentProduct.image}" alt="${currentProduct.name}" 
                         class="rounded me-3" style="width: 80px; height: 80px; object-fit: cover;">
                    <div class="flex-grow-1">
                        <h6 class="mb-1">${currentProduct.name}</h6>
                        <small class="text-muted">
                            ${currentProduct.variants.color ? 'اللون: ' + currentProduct.variants.color + ' | ' : ''}
                            ${currentProduct.variants.storage ? 'التخزين: ' + currentProduct.variants.storage + ' | ' : ''}
                            ${currentProduct.variants.ram ? 'الذاكرة: ' + currentProduct.variants.ram : ''}
                        </small>
                        <div class="d-flex justify-content-between align-items-center mt-2">
                            <span>الكمية: ${currentProduct.quantity}</span>
                            <span class="fw-bold">${(currentProduct.price * currentProduct.quantity).toLocaleString()} د.ج</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateOrderSummary() {
            const productTotal = currentProduct ? currentProduct.price * currentProduct.quantity : 0;
            const total = productTotal + shippingCost;

            document.getElementById('shippingCost').textContent = 
                shippingCost === 0 ? 'مجاني' : `${shippingCost.toLocaleString()} د.ج`;
            document.getElementById('totalAmount').textContent = `${total.toLocaleString()} د.ج`;
        }

        function initializeFormValidation() {
            const form = document.getElementById('orderForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                e.stopPropagation();

                if (form.checkValidity()) {
                    processOrder();
                } else {
                    form.classList.add('was-validated');
                }
            });
        }

        function processOrder() {
            // Show loading
            const submitBtn = document.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>جاري المعالجة...';
            submitBtn.disabled = true;

            // Collect form data
            const formData = new FormData(document.getElementById('orderForm'));
            const orderData = {
                customer: {
                    firstName: formData.get('firstName'),
                    lastName: formData.get('lastName'),
                    email: formData.get('email'),
                    phone: formData.get('phone')
                },
                delivery: {
                    wilaya: formData.get('wilaya'),
                    commune: formData.get('commune'),
                    address: formData.get('address'),
                    postalCode: formData.get('postalCode'),
                    deliveryTime: formData.get('deliveryTime')
                },
                payment: {
                    method: formData.get('paymentMethod')
                },
                product: currentProduct,
                total: (currentProduct.price * currentProduct.quantity) + shippingCost,
                shippingCost: shippingCost,
                notes: formData.get('notes'),
                orderDate: new Date().toISOString(),
                orderStatus: 'pending'
            };

            // Store order data
            localStorage.setItem('currentOrder', JSON.stringify(orderData));

            // Simulate API call
            setTimeout(() => {
                // Redirect to success page
                window.location.href = 'success.html';
            }, 2000);
        }

        // Add checkout progress styling
        const style = document.createElement('style');
        style.textContent = `
            .checkout-progress {
                margin: 1rem 0;
            }
            .progress-step {
                display: flex;
                flex-direction: column;
                align-items: center;
                position: relative;
            }
            .step-number {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: #e9ecef;
                color: #6c757d;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-bottom: 0.5rem;
                transition: all 0.3s ease;
            }
            .progress-step.active .step-number {
                background: var(--primary-color);
                color: white;
            }
            .progress-step.completed .step-number {
                background: var(--success-color);
                color: white;
            }
            .step-label {
                font-size: 0.9rem;
                font-weight: 600;
                text-align: center;
            }
            .progress-line {
                width: 80px;
                height: 2px;
                background: #e9ecef;
                margin-top: 20px;
            }
            .progress-line.active {
                background: var(--primary-color);
            }
            @media (max-width: 768px) {
                .checkout-progress {
                    flex-wrap: wrap;
                }
                .progress-step {
                    margin: 0.5rem;
                }
                .progress-line {
                    display: none;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>